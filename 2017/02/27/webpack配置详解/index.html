<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>webpack配置详解 - 视觉码农</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com"><span>Github</span></a></li><li><a href="https://www.v2ex.com/"><span>V2EX</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="http://callfiles.ueibo.com/hexo-theme-laughing/post_background.jpg"><div class="post-title"><h1 class="title">webpack配置详解</h1><ul class="meta"><li><i class="icon icon-author"></i>swimly</li><li><i class="icon icon-clock"></i>23 Minutes</li><li><i class="icon icon-calendar"></i>February 27, 2017</li></ul></div></div><div class="article-content" style="max-width:800px"><h1 id="webpack配置"><a href="#webpack配置" class="headerlink" title="webpack配置"></a>webpack配置</h1><p>webpack前前后后也折腾过很多次了，每次也都是弄个似懂非懂也就放弃了，也就相当于研究一门语言，成功运行hello world就放弃是一样的，这次就对这么久研究的成果做个汇总，方便日后查询。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ npm init</div><div class="line">$ npm install webpack --save-dev <span class="comment"># 全局安装依赖</span></div><div class="line"><span class="comment"># or</span></div><div class="line">$ npm install webpack-dev-server --save-dev <span class="comment"># 安装webpack调试工具</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// config/webpack.config.js</span></div><div class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</div><div class="line"></div><div class="line"><span class="comment">// 配置目录</span></div><div class="line"><span class="comment">// 因为我们的webpack.config.js文件不在项目根目录下，所以需要一个路径的配置</span></div><div class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</div><div class="line"><span class="keyword">const</span> CURRENT_PATH = path.resolve(__dirname); <span class="comment">// 获取到当前目录</span></div><div class="line"><span class="keyword">const</span> ROOT_PATH = path.join(__dirname, <span class="string">'../'</span>); <span class="comment">// 项目根目录</span></div><div class="line"><span class="keyword">const</span> MODULES_PATH = path.join(CURRENT_PATH, <span class="string">'./node_modules'</span>); <span class="comment">// node包目录</span></div><div class="line"><span class="keyword">const</span> BUILD_PATH = path.join(CURRENT_PATH, <span class="string">'./public/assets'</span>); <span class="comment">// 最后输出放置公共资源的目录</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  context: path.join(__dirname, <span class="string">'../'</span>), <span class="comment">// 设置webpack配置中指向的默认目录为项目根目录</span></div><div class="line">  entry: &#123;</div><div class="line">    index: <span class="string">'./public/pages/index.js'</span>,</div><div class="line">    public: <span class="string">'./public/pages/public.js'</span></div><div class="line">  &#125;,</div><div class="line">  output: &#123;</div><div class="line">    path: BUILD_PATH, <span class="comment">// 设置输出目录</span></div><div class="line">    filename: <span class="string">'[name].bundle.js'</span>, <span class="comment">// 输出文件名</span></div><div class="line">  &#125;,</div><div class="line">  resolve: &#123;</div><div class="line">    extensions: [<span class="string">''</span>, <span class="string">'.js'</span>, <span class="string">'.jsx'</span>, <span class="string">'.coffee'</span>] <span class="comment">// 配置简写，配置过后，书写该文件路径的时候可以省略文件后缀</span></div><div class="line">  &#125;,</div><div class="line">  <span class="built_in">module</span>: &#123;</div><div class="line">    loaders: [</div><div class="line">      <span class="comment">// loader 扔在这里</span></div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  plugins: [</div><div class="line">    <span class="comment">// 插件扔在这里</span></div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h2><p>根据项目需求安装对应的loader，loader一般以 功能名称_loader命名，下面就less的配置进行安装loader<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ npm install less --save-dev <span class="comment"># install less</span></div><div class="line"></div><div class="line">$ npm install css-loader style-loader --save-dev <span class="comment"># install style-loader, css-loader</span></div><div class="line"></div><div class="line">$ npm install less less-loader --save-dev <span class="comment"># 基于style-loader,css-loader</span></div></pre></td></tr></table></figure></p>
<h3 id="install-url-loader"><a href="#install-url-loader" class="headerlink" title="install url loader"></a>install url loader</h3><p>用来处理图片和字体文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ npm install file-loader --save-dev</div><div class="line">$ npm install url-loader --save-dev</div></pre></td></tr></table></figure></p>
<h3 id="install-babel-loader"><a href="#install-babel-loader" class="headerlink" title="install babel loader"></a>install babel loader</h3><p>写es6必须的loader<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install babel-loader babel-core babel-preset-es2015 --save-dev</div></pre></td></tr></table></figure></p>
<h3 id="修改config的loader部分"><a href="#修改config的loader部分" class="headerlink" title="修改config的loader部分"></a>修改config的loader部分</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// config/webpack.config.js</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = &#123;</div><div class="line">  <span class="built_in">module</span>: &#123;</div><div class="line">    loaders: [</div><div class="line">      <span class="comment">// style &amp; css &amp; less loader</span></div><div class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">loader</span>: <span class="string">"style-loader!css-loader"</span>&#125;,</div><div class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.less$/</span>, <span class="attr">loader</span>: <span class="string">"style-loader!css-loader!less-loader"</span>)&#125;,</div><div class="line">      <span class="comment">// babel loader</span></div><div class="line">      &#123;</div><div class="line">        test: <span class="regexp">/\.jsx?$/</span>,</div><div class="line">        exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</div><div class="line">        loader: [<span class="string">'babel-loader'</span>],</div><div class="line">        query: &#123;</div><div class="line">          presets: [<span class="string">'es2015'</span>]</div><div class="line">          <span class="comment">// 如果安装了React的话</span></div><div class="line">          <span class="comment">// presets: ['react', 'es2015']</span></div><div class="line">        &#125;</div><div class="line">      &#125;,</div><div class="line">      <span class="comment">// image &amp; font</span></div><div class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.(woff|woff2|eot|ttf|otf)$/i</span>, <span class="attr">loader</span>: <span class="string">'url-loader?limit=8192&amp;name=[name].[ext]'</span>&#125;,</div><div class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.(jpe?g|png|gif|svg)$/i</span>, <span class="attr">loader</span>: <span class="string">'url-loader?limit=8192&amp;name=[name].[ext]'</span>&#125;,</div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><p>ExtractTextPlugin：分离css，最讨厌webpack打包之后生成一坨行业css。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># install ExtractTextPlugin</span></div><div class="line">$ npm install extract-text-webpack-plugin --save-dev</div></pre></td></tr></table></figure></p>
<h3 id="修改config的plugins"><a href="#修改config的plugins" class="headerlink" title="修改config的plugins"></a>修改config的plugins</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// config/webpack.config.js</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">"extract-text-webpack-plugin"</span>);</div><div class="line"></div><div class="line"><span class="built_in">module</span>: &#123;</div><div class="line">  loaders: [</div><div class="line">    <span class="comment">// 把之前的style&amp;css&amp;less loader改为</span></div><div class="line">    &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">loader</span>: ExtractTextPlugin.extract(<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>)&#125;,</div><div class="line">    &#123; <span class="attr">test</span>: <span class="regexp">/\.less$/</span>, <span class="attr">loader</span>: ExtractTextPlugin.extract(<span class="string">'style'</span>, <span class="string">'css!less'</span>) &#125;,</div><div class="line">  ]</div><div class="line">&#125;,</div><div class="line">plugins: [</div><div class="line">  <span class="comment">// 分离css</span></div><div class="line">  <span class="keyword">new</span> ExtractTextPlugin(<span class="string">'[name].bundle.css'</span>, &#123;</div><div class="line">    allChunks: <span class="literal">true</span></div><div class="line">  &#125;),</div><div class="line">]</div></pre></td></tr></table></figure>
<h2 id="设置jQuery全局变量"><a href="#设置jQuery全局变量" class="headerlink" title="设置jQuery全局变量"></a>设置jQuery全局变量</h2><p>虽然jQuery已经略显老土，但是平常工作中我们还是不可避免的要用到，如果我们把jQuery设置成全局变量，这样又可以方便使用我们所熟悉的$了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ npm install jquery --save-dev</div><div class="line"></div><div class="line"><span class="comment"># 安装 expose-loader</span></div><div class="line">$ sudo npm install expose-loader --save</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// config/webpack.config.js</span></div><div class="line"></div><div class="line"><span class="built_in">module</span>: &#123;</div><div class="line">  loaders: [</div><div class="line">    <span class="comment">// expose-loader将需要的变量从依赖包中暴露出来</span></div><div class="line">    &#123; <span class="attr">test</span>: <span class="built_in">require</span>.resolve(<span class="string">"jquery"</span>), <span class="attr">loader</span>: <span class="string">"expose?$! expose?jQuery"</span> &#125;</div><div class="line">  ]</div><div class="line">&#125;,</div><div class="line">plugins: [</div><div class="line">  <span class="comment">// 把jquery作为全局变量插入到所有的代码中</span></div><div class="line">  <span class="comment">// 然后就可以直接在页面中使用jQuery了</span></div><div class="line">  <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</div><div class="line">    $: <span class="string">'jquery'</span>,</div><div class="line">    jQuery: <span class="string">'jquery'</span>,</div><div class="line">    <span class="string">'window.jQuery'</span>: <span class="string">'jquery'</span></div><div class="line">  &#125;),</div><div class="line">]</div></pre></td></tr></table></figure>
<h2 id="CommonsChunkPlugin抽取公共资源"><a href="#CommonsChunkPlugin抽取公共资源" class="headerlink" title="CommonsChunkPlugin抽取公共资源"></a>CommonsChunkPlugin抽取公共资源</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// config/webpack.config.js</span></div><div class="line"></div><div class="line">entry: &#123;</div><div class="line">  jquery: [<span class="string">'jquery'</span>]</div><div class="line">&#125;,</div><div class="line">plugins: [</div><div class="line">  <span class="comment">// public sources</span></div><div class="line">  <span class="keyword">new</span> webpack.optimize.CommonsChunkPlugin(&#123;</div><div class="line">    <span class="comment">// 与 entry 中的 jquery 对应</span></div><div class="line">    name: <span class="string">'jquery'</span>,</div><div class="line">    <span class="comment">// 输出的公共资源名称</span></div><div class="line">    filename: <span class="string">'common.bundle.js'</span>,</div><div class="line">    <span class="comment">// 对所有entry实行这个规则</span></div><div class="line">    minChunks: <span class="literal">Infinity</span></div><div class="line">  &#125;),</div><div class="line">]</div></pre></td></tr></table></figure>
<h2 id="UglifyJsPlugin代码压缩混淆"><a href="#UglifyJsPlugin代码压缩混淆" class="headerlink" title="UglifyJsPlugin代码压缩混淆"></a>UglifyJsPlugin代码压缩混淆</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// config/webpack.config.js</span></div><div class="line"></div><div class="line">plugins: [</div><div class="line">  <span class="keyword">new</span> webpack.optimize.UglifyJsPlugin(&#123;</div><div class="line">    mangle: &#123;</div><div class="line">      except: [<span class="string">'$super'</span>, <span class="string">'$'</span>, <span class="string">'exports'</span>, <span class="string">'require'</span>]</div><div class="line">      <span class="comment">//以上变量‘$super’, ‘$’, ‘exports’ or ‘require’，不会被混淆</span></div><div class="line">    &#125;,</div><div class="line">    compress: &#123;</div><div class="line">      warnings: <span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">]</div></pre></td></tr></table></figure>
<h2 id="react开发"><a href="#react开发" class="headerlink" title="react开发"></a>react开发</h2><p>react+webpack+redux所谓是标配，下面就走起：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># react</span></div><div class="line">$ npm install react --save</div><div class="line">$ npm install react-dom --save</div><div class="line"></div><div class="line"><span class="comment"># 喜欢redux?</span></div><div class="line">$ npm install --save redux <span class="comment"># redux</span></div><div class="line">$ npm install --save react-redux <span class="comment"># 和react配合</span></div><div class="line">$ npm install --save redux-thunk <span class="comment"># middleware</span></div><div class="line"></div><div class="line"><span class="comment"># 如果已经装了babel可以忽略下面这条</span></div><div class="line">$ npm install babel-loader babel-core babel-preset-es2015 --save-dev</div><div class="line"></div><div class="line"><span class="comment"># 但是要用React的话一定记得安装下面这个</span></div><div class="line">$ npm install babel-preset-react --save-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">loaders: [</div><div class="line">  &#123;</div><div class="line">    test: <span class="regexp">/\.jsx?$/</span>,</div><div class="line">    exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</div><div class="line">    loader: [<span class="string">'babel-loader'</span>],</div><div class="line">    query: &#123;</div><div class="line">      presets: [<span class="string">'react'</span>, <span class="string">'es2015'</span>]</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">]</div></pre></td></tr></table></figure>
<h2 id="呃，bug"><a href="#呃，bug" class="headerlink" title="呃，bug"></a>呃，bug</h2><p>在最新的React，如果按照上面的配置使用的话，会出现如下警告：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Warning: It looks like you<span class="string">'re using a minified copy of the development build of React. When deploying React apps to production, make sure to use the production build which skips development warnings and is faster. See https://fb.me/react-minification for more details.</span></div></pre></td></tr></table></figure></p>
<p>在Webpack的plugins里添加：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> webpack.DefinePlugin(&#123;</div><div class="line">  <span class="string">"process.env"</span>: &#123; </div><div class="line">     NODE_ENV: <span class="built_in">JSON</span>.stringify(<span class="string">"production"</span>) </div><div class="line">   &#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
</div><div class="article-meta" style="max-width:800px"></div><div class="article-comment" style="max-width:800px"><div class="ds-thread" id="ds-thread" data-thread-key="cj7zjmybx0007mov9vzod7sdf" data-title="webpack配置详解" data-url="http://www.viscode.cn/2017/02/27/webpack配置详解/" site-name="ueibo"></div><script>var siteName = document.getElementById('ds-thread').getAttribute('site-name');
var duoshuoQuery = {short_name: siteName};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
  || document.getElementsByTagName('body')[0]).appendChild(ds);
})();</script></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2017/09/11/react-native调用android原生方法！(Toast初试)/"><i class="icon icon-arror-left"></i></a></li><li><a href="/2017/02/22/webpack详解/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/BoizZ" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/heqibang" title="Weibo" target="_blank"><i class="icon icon-weibo"></i></a></li><li><a href="https://www.segmentfault.com/u/bon" title="SegmentFault" target="_blank"><i class="icon icon-segmentfault"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2017 视觉码农<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>